<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='onlycelebs.css') }}" type="text/css">
    
    <!-- FIX: Corrected 'xintegrity' to 'integrity' -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      xintegrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"></script>
    <!-- FIX: Corrected 'xintegrity' to 'integrity' -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      xintegrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"></script>
  </head>

  <body class="bg-gradient">
  <!-- Put this inside your base.html file -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <!-- This div will hold all the flashed messages -->
        <div class="flashed-messages" style="width: 100%; text-align: center; position: absolute; top: 0; left: 0; z-index: 100;">
          {% for category, message in messages %}
            <!-- 
              It styles the message based on the category you provided.
              e.g., 'danger' gets a red background, 'success' gets green.
            -->
            
            <!-- This uses your corrected class attribute, which is great! -->
            <!-- Your CSS file should now handle styling for .alert-danger, .alert-success etc. -->
            <div class="alert alert-{{ category }}" style="padding: 1rem; color: white;">

              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    
    {% block content %}
    {% endblock %}
  </body>
  <script>
      // Generic function to toggle a dropdown visibility
      function toggleDropdown(button, dropdown) {
          const isHidden = dropdown.classList.contains('hidden');
          
          // Close all other dropdowns
          document.querySelectorAll('[data-dropdown]').forEach(d => {
              if (d !== dropdown) {
                  d.classList.add('hidden');
                  d.classList.remove('active-dropdown');
                  d.classList.remove('opacity-100', 'scale-100');
                  d.classList.add('opacity-0', 'scale-95');
                  d.style.maxHeight = '0';
              }
          });

          // Toggle the current dropdown
          if (isHidden) {
              // SHOW
              dropdown.classList.remove('hidden');
              dropdown.classList.add('active-dropdown');
              // Force reflow/repaint to ensure transition works
              void dropdown.offsetWidth; 
              dropdown.classList.remove('opacity-0', 'scale-95');
              dropdown.classList.add('opacity-100', 'scale-100');
              // Set max-height for smooth height transition
              dropdown.style.maxHeight = dropdown.scrollHeight + 'px'; 

          } else {
              // HIDE
              dropdown.classList.remove('opacity-100', 'scale-100');
              dropdown.classList.add('opacity-0', 'scale-95');
              dropdown.style.maxHeight = '0'; // Start closing transition

              // Wait for transition to finish before hiding completely
              setTimeout(() => {
                  dropdown.classList.add('hidden');
                  dropdown.classList.remove('active-dropdown');
              }, 200); // 200ms matches the 'duration-200' in Tailwind
          }
      }

      // --- Event Listeners ---
      const dropdowns = [
          { buttonId: 'notificationButton', dropdownId: 'notificationDropdown' },
          { buttonId: 'menuButton', dropdownId: 'menuDropdown' },
          { buttonId: 'userMenuButton', dropdownId: 'userDropdown' }
      ];

      dropdowns.forEach(({ buttonId, dropdownId }) => {
          const button = document.getElementById(buttonId);
          const dropdown = document.getElementById(dropdownId);
          
          // Add a marker for the closing function
          if(dropdown) {
              dropdown.setAttribute('data-dropdown', 'true');
          }

          if (button && dropdown) {
              button.addEventListener('click', (event) => {
                  event.stopPropagation(); // Prevents the document click listener from firing immediately
                  toggleDropdown(button, dropdown);
              });
          }
      });

      // Close dropdowns when clicking outside
      document.addEventListener('click', (event) => {
          document.querySelectorAll('[data-dropdown]').forEach(dropdown => {
              if (!event.target.closest('.relative') || !event.target.closest('#' + dropdown.id)) {
                  if (dropdown.classList.contains('active-dropdown')) {
                      toggleDropdown(null, dropdown); // Pass null for button as it's not needed for closing
                  }
              }
          });
      });

  </script>

</html>

